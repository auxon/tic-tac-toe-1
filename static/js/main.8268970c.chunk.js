(this["webpackJsonptic-tac-toe"]=this["webpackJsonptic-tac-toe"]||[]).push([[0],{12:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return c}));var r,a,s=n(17);!function(e){e.Testnet="testnet",e.Regtest="regtest",e.Mainnet="mainnet",e.STN="STN"}(r||(r={})),function(e){e[e.ALL=65]="ALL",e[e.SINGLE=67]="SINGLE",e[e.NONE=66]="NONE",e[e.ANYONECANPAY_ALL=193]="ANYONECANPAY_ALL",e[e.ANYONECANPAY_SINGLE=195]="ANYONECANPAY_SINGLE",e[e.ANYONECANPAY_NONE=194]="ANYONECANPAY_NONE"}(a||(a={}));var c=function e(t){Object(s.a)(this,e),this.network=void 0,this.network=t}},164:function(e,t){},173:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var r=n(1),a=n.n(r),s=n(7),c=n(17),o=n(22),i=n(3),u=n(12),l=n(32),p=n.n(l),d=n(34),b=n(63),f=n(6),h=2e3,v=function(){function t(){Object(c.a)(this,t)}return Object(o.a)(t,null,[{key:"setWallet",value:function(e){t.wallet=e}},{key:"version",value:function(){return"0.0.1"}},{key:"loadContract",value:function(e){return p.a.get(e,{timeout:1e4}).then((function(e){return{contractClass:Object(i.buildContractClass)(e.data),types:Object(i.buildTypeClasses)(e.data)}}))}},{key:"buildDeployTx",value:function(){var t=Object(s.a)(a.a.mark((function t(n,r){var c,o,l,p,v;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=new b.a,o="",l="",(p={inputs:[],outputs:[]}).outputs.push({script:n.lockingScript.toHex(),satoshis:r}),v=r+h,t.abrupt("return",c.listUnspent(v,{purpose:"alice"}).then(function(){var e=Object(s.a)(a.a.mark((function e(t){var n,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}throw new Error("no utxos");case 2:if(p.inputs.push({utxo:t[0],script:"",sequence:0}),o=t[0].addr||"",l=t[0].pubkey||"",f.c.set(l,"alice"),f.b.set(o,"alice"),f.c.set(l,"bob"),f.b.set(o,"bob"),!((n=t[0].satoshis-r-h)<=0)){e.next=12;break}throw new Error("fund is not enough");case 12:return s=i.bsv.Script.buildPublicKeyHashOut(o).toHex(),p.outputs.push({script:s,satoshis:n}),e.abrupt("return",p);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(t){return c.getSignature(Object(d.d)(t),0,u.b.ALL,o).then((function(n){window.bsv=i.bsv;var r=new i.bsv.Script("").add(e.from(n,"hex")).add(new i.bsv.PublicKey(l).toBuffer()).toHex();return t.inputs[0].script=r,t}))})));case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setAllPublicKey",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r,c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new b.a,r="",c="",o=t+h,e.abrupt("return",n.listUnspent(o,{purpose:"alice"}).then(function(){var e=Object(s.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=2;break}throw new Error("no utxos");case 2:if(r=n[0].addr||"",c=n[0].pubkey||"",f.c.set(c,"alice"),f.b.set(r,"alice"),f.c.set(c,"bob"),f.b.set(r,"bob"),!(n[0].satoshis-t-h<=0)){e.next=11;break}throw new Error("fund is not enough");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRawTx",value:function(){var e=Object(s.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.wallet.sendRawTransaction(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendTx",value:function(){var e=Object(s.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.wallet.sendRawTransaction(Object(d.d)(n)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"deploy",value:function(){var e=Object(s.a)(a.a.mark((function e(n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.buildDeployTx(n,r).then(function(){var e=Object(s.a)(a.a.mark((function e(n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.sendTx(n).then((function(e){return[n,e]})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}();v.wallet=void 0}).call(this,n(0).Buffer)},187:function(e,t,n){},189:function(e,t,n){},206:function(e,t){},207:function(e,t){},228:function(e,t){},230:function(e,t){},241:function(e,t){},243:function(e,t){},270:function(e,t){},272:function(e,t){},277:function(e,t){},279:function(e,t){},291:function(e,t){},294:function(e,t){},323:function(e,t){},34:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return i}));var r=n(3),a=n(12);function s(e,t,n,a,s){t.inputs[n].output=new r.bsv.Transaction.Output({script:r.bsv.Script.fromHex(s.script),satoshis:s.satoshis});var c=new r.bsv.Transaction.Signature({publicKey:e.publicKey,prevTxId:s.txHash,outputIndex:s.outputIndex,inputIndex:n,signature:r.bsv.Transaction.Sighash.sign(t,e,a,n,t.inputs[n].output.script,t.inputs[n].output.satoshisBN),sigtype:a});return r.bsv.Script.buildPublicKeyHashIn(c.publicKey,c.signature.toDER(),c.sigtype).toHex()}function c(e){var t=new r.bsv.Transaction;return e.inputs.forEach((function(e){t.addInput(new r.bsv.Transaction.Input({prevTxId:e.utxo.txHash,outputIndex:e.utxo.outputIndex,sequenceNumber:e.sequence,script:e.script?r.bsv.Script.fromHex(e.script):new r.bsv.Script("")}),r.bsv.Script.fromHex(e.utxo.script),e.utxo.satoshis)})),e.outputs.forEach((function(e){t.addOutput(new r.bsv.Transaction.Output({script:r.bsv.Script.fromHex(e.script),satoshis:e.satoshis}))})),t.nLockTime=e.nLockTime||0,t}function o(e){return c(e).toString()}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.b.ALL,s=c(e);return Object(r.getPreimage)(s,r.bsv.Script.fromHex(e.inputs[t].utxo.script).toASM(),e.inputs[t].utxo.satoshis,t,n)}},340:function(e,t){},366:function(e,t,n){"use strict";n.r(t);var r=n(10),a=n.n(r),s=n(182),c=n.n(s),o=(n(187),n(1)),i=n.n(o),u=n(7),l=n(35),p=(n(189),n(17)),d=n(22),b=n(31),f=n(30),h=n(2),v=function(e){var t=e.value?"https://whatsonchain.com/tx/".concat(e.value.tx):"",n=e.value?Object(h.jsx)("div",{className:"squareicon",children:e.value.n}):"";return Object(h.jsxs)("div",{className:"squarewapper",children:[Object(h.jsx)("button",{className:"".concat(e.winnerClass," square"),onClick:e.onClick,children:e.value?Object(h.jsx)("a",{href:t,target:"_blank",title:"Click to see the transaction",children:e.value.label}):e.value}),n]})},g=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"createBoard",value:function(e,t){for(var n=[],r=0,a=0;a<e;a+=1){for(var s=[],c=0;c<t;c+=1)s.push(this.renderSquare(r++));n.push(Object(h.jsx)("div",{className:"board-row",children:s},a))}return n}},{key:"renderSquare",value:function(e){var t=this,n=!this.props.winnerSquares||this.props.winnerSquares[0]!==e&&this.props.winnerSquares[1]!==e&&this.props.winnerSquares[2]!==e?"":"square--green";return Object(h.jsx)(v,{winnerClass:n,value:this.props.squares[e],onClick:function(){return t.props.onClick(e)}},e)}},{key:"render",value:function(){return Object(h.jsx)("div",{children:this.createBoard(3,3)})}}]),n}(a.a.Component),x=n(3),w=n(173),m=n(12),y=n(34),j=n(32),O=n.n(j),_=(m.c,n(63)),k=n(76),N=n(42),S=n(6),P=new(function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(p.a)(this,n),(e=t.call(this)).player="",e.privKey="",e.accessToken="",e.deleteGame=function(){console.log("deleteGame"),window.localStorage.removeItem("game")},e.createGame=function(e){return e.event="createGame",console.log("createGame",e),window.localStorage.setItem("game",JSON.stringify(e))},e.saveGame=function(e,t){e.event=t,console.log("saveGame",e),window.localStorage.setItem("game",JSON.stringify(e))},e.getGame=function(){var e=window.localStorage.getItem("game");if(e&&null!==e)return JSON.parse(e)},e.getCurrentPlayer=function(){return e.player},e.savePrivateKey=function(t){e.privKey=t,window.localStorage.setItem(e.player,t)},e.getPrivateKey=function(){return e.player&&(e.privKey=window.localStorage.getItem(e.player)),e.privKey},e.getBobPrivateKey=function(){return window.localStorage.getItem("bob")},e.getAlicePrivateKey=function(){return window.localStorage.getItem("alice")},e.getAccessToken=function(){return e.player&&(e.accessToken=S.d.get()),e.accessToken};var r=new URLSearchParams(window.location.search);e.player=r.get("player")||"alice";var a=Object(k.a)(e);return e.accessToken=S.d.get(),window.addEventListener("storage",(function(t){if(console.log("on storage change "+e.player,t),"game"===t.key)try{var n=window.localStorage.getItem("game");if(n&&null!==n){var r=JSON.parse(n);r.event&&a.emit(r.event,r)}}catch(t){console.error(" storage change error",t)}}),!1),e}return Object(d.a)(n,[{key:"addDeployedListener",value:function(e){console.log("addDeployedListener"),this.on("deployed",e)}},{key:"removeDeployedListener",value:function(e){console.log("removeDeployedListener"),this.off("deployed",e)}},{key:"addNextListener",value:function(e){console.log("addNextListener"),this.on("next",e)}},{key:"removeNextListener",value:function(e){console.log("removeNextListener"),this.off("next",e)}}]),n}(N.EventEmitter)),I=function(e){for(var t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],n=0;n<t.length;n+=1){var r=Object(l.a)(t[n],3),a=r[0],s=r[1],c=r[2];if(e[a]&&e[s]&&e[c]&&e[a].label===e[s].label&&e[a].label===e[c].label)return{winner:e[a],winnerRow:t[n]}}return{winner:null,winnerRow:null}},A={history:[{squares:Array(9).fill(null)}],currentStepNumber:0,xIsNext:!0},T=function(e){Object(b.a)(n,e);var t=Object(f.a)(n);function n(e){var r;return Object(p.a)(this,n),r=t.call(this,e),e.game&&e.game.gameState?r.state=e.game.gameState:r.state=A,r}return Object(d.a)(n,[{key:"componentWillReceiveProps",value:function(e){console.log("componentWillReceiveProps",e),e.game&&e.game.gameState?this.setState(e.game.gameState):this.setState(A)}},{key:"calculateNewState",value:function(e){return(this.state.xIsNext?"01":"00")+e.map((function(e){return e&&"X"===e.label?"01":e&&"O"===e.label?"02":"00"})).join("")}},{key:"calculateOldState",value:function(e){return(this.state.xIsNext?"00":"01")+e.map((function(e){return e&&"X"===e.label?"01":e&&"O"===e.label?"02":"00"})).join("")}},{key:"checkIfValid",value:function(e,t){if(!this.props.game||!this.props.game.lastUtxo)return!1;if(I(t).winner||t[e])return!1;t[e]={label:this.state.xIsNext?"X":"O"};var n=P.getCurrentPlayer();return!("alice"!==n||!this.state.xIsNext)||("bob"===n&&!this.state.xIsNext||(alert("now is ".concat(this.state.xIsNext?"Alice":"Bob"," turn ")),console.error("now is ".concat(this.state.xIsNext?"Alice":"Bob"," turn , but got ").concat(n)),!1))}},{key:"buildCallContractTx",value:function(){var e=Object(u.a)(i.a.mark((function e(t,n,r,a,s){var c,o,u,l,p,d,b,f,h,v,g,j,O,_,k,N,P;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="",o=I(a).winner,u=3e3,l=[],p=this.props.game.lastUtxo.satoshis-u,!o){e.next=14;break}return d=Object(S.g)(),e.next=9,S.b.get(d);case 9:b=e.sent,c=x.bsv.Script.buildPublicKeyHashOut(b).toHex(),l.push({satoshis:p,script:c}),e.next=15;break;case 14:s.length>=9?(f=new x.bsv.PublicKey(this.props.game.alicePubKey,{network:x.bsv.Networks.testnet}),h=new x.bsv.PublicKey(this.props.game.bobPubKey,{network:x.bsv.Networks.testnet}),v=x.bsv.Script.buildPublicKeyHashOut(f.toAddress(x.bsv.Networks.testnet)).toHex(),g=x.bsv.Script.buildPublicKeyHashOut(h.toAddress(x.bsv.Networks.testnet)).toHex(),p=(this.props.game.lastUtxo.satoshis-u)/2,l.push({satoshis:p,script:v}),l.push({satoshis:p,script:g})):(c=[this.props.contractInstance.codePart.toHex(),x.bsv.Script.fromASM(n).toHex()].join(""),l.push({satoshis:p,script:c}));case 15:if(!(l[0].satoshis<=0)){e.next=18;break}return alert("fund in contract is too low "),e.abrupt("return",void 0);case 18:return j={inputs:[{utxo:this.props.game.lastUtxo,sequence:0,script:""}],outputs:l},O=Object(y.a)(j),_=S.b.get(),e.next=23,w.a.wallet.getSignature(Object(y.d)(j),0,m.b.ALL,_);case 23:if(k=e.sent,this.props.contractInstance.setDataPart(r),N=this.props.contractInstance.move(t,new x.Sig(Object(x.toHex)(k)),p,O).toHex(),j.inputs[0].script=N,(P=this.props.contractInstance.move(t,new x.Sig(Object(x.toHex)(k)),p,O).verify({inputSatoshis:this.props.game.lastUtxo.satoshis,tx:Object(y.c)(j)})).success){e.next=30;break}throw new Error(P.error);case 30:return e.abrupt("return",j);case 31:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"handleClick",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var n,r,a,s,c,o,u=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state.history.slice(0,this.state.currentStepNumber+1),r=n[n.length-1],a=r.squares.slice(),s=this.calculateOldState(a),this.checkIfValid(t,a)){e.next=7;break}return console.error("handleClick checkIfValid false..."),e.abrupt("return");case 7:return c=this.calculateNewState(a),e.next=10,this.buildCallContractTx(t,c,s,a,n);case 10:if(o=e.sent){e.next=14;break}return console.error("buildCallContractTx fail..."),e.abrupt("return");case 14:w.a.sendTx(o).then((function(e){a[t].tx=e,a[t].n=n.length;var r,s={history:n.concat([{squares:a,currentLocation:(r=t,{0:"row: 1, col: 1",1:"row: 1, col: 2",2:"row: 1, col: 3",3:"row: 2, col: 1",4:"row: 2, col: 2",5:"row: 2, col: 3",6:"row: 3, col: 1",7:"row: 3, col: 2",8:"row: 3, col: 3"}[r]),stepNumber:n.length}]),xIsNext:!u.state.xIsNext,currentStepNumber:n.length};P.saveGame(Object.assign({},u.props.game,{gameState:s,lastUtxo:{txHash:e,outputIndex:0,satoshis:o.outputs[0].satoshis,script:o.outputs[0].script}}),"next"),u.setState(s)})).catch((function(e){e.response&&alert("sendTx errror: "+e.response.data),console.error("sendTx errror",e.response)}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,r,a=this,s=this.state.history,c=s[this.state.currentStepNumber],o=I(c.squares),i=o.winner,u=o.winnerRow,l=P.getGame();n="bob"===P.getCurrentPlayer()?Object(h.jsxs)("div",{className:"bob",children:["Bob",Object(h.jsx)("img",{src:"/bob.png"})]}):Object(h.jsxs)("div",{className:"alice",children:["Alice",Object(h.jsx)("img",{src:"/alice.jpg"})]}),l&&l.deploy&&(r=Object(h.jsxs)("div",{className:"bet",children:[Object(h.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(l.deploy),target:"_blank",children:"Bet transaction"})," "]}));P.getCurrentPlayer();if(i){var p="X"===i.label?"Alice":"Bob";e="Winner is ".concat(p),l&&l.lastUtxo&&(t=Object(h.jsxs)("div",{className:"end",children:[Object(h.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(l.lastUtxo.txHash),target:"_blank",children:"Withdraw transaction"})," "]}))}else if(10===s.length)e="Draw. No one won.",l&&l.lastUtxo&&(t=Object(h.jsxs)("div",{className:"end",children:[Object(h.jsx)("a",{href:"https://whatsonchain.com/tx/".concat(l.lastUtxo.txHash),target:"_blank",children:"Withdraw transaction"})," "]}));else{var d=this.state.xIsNext?"Alice":"Bob";e="Next player: ".concat(d)}return Object(h.jsx)("div",{className:"game",children:Object(h.jsxs)("div",{className:"game-board",children:[Object(h.jsxs)("div",{className:"game-title",children:[n,Object(h.jsxs)("div",{className:"game-status",children:[" ",e," "]})]}),Object(h.jsx)(g,{squares:c.squares,winnerSquares:u,onClick:function(e){return a.handleClick(e)}}),Object(h.jsxs)("div",{className:"game-bottom",children:[r,t]})]})})}}]),n}(a.a.Component);var L=function(e){a.a.useReducer((function(e){return!e}))[1];var t=Object(r.useRef)(null),n=function(t){e.cancelBet()};if(e.started)return Object(h.jsxs)("div",{children:["The game is in progress ...",Object(h.jsx)("button",{className:"pure-button cancel",onClick:n,children:"Restart"})]});if(e.game&&e.game.creator===P.getCurrentPlayer()){var s="alice"===P.getCurrentPlayer()?"bob":"alice",c=window.location.href.split("?")[0];return Object(h.jsxs)("div",{children:["Waiting someone join the game ...",Object(h.jsx)("a",{className:"pure-button",href:c+"?player="+s,target:"_blank",children:" Join"}),Object(h.jsx)("button",{className:"pure-button cancel",onClick:n,children:"Restart"})]})}return e.game&&e.game.creator!==P.getCurrentPlayer()?Object(h.jsx)("div",{children:"Joining the game..."}):Object(h.jsxs)("div",{children:[Object(h.jsxs)("label",{children:["Bet amount:",Object(h.jsx)("input",{ref:t,type:"number",name:"amount",placeholder:"in satoshis"})]}),Object(h.jsx)("button",{className:"start",onClick:function(n){if(w.a.wallet){var r=parseInt(t.current.value);r<2e4?alert("The bet fund is too small to play, at least 20000"):isNaN(r)?console.error("".concat(t.current.value," is not number")):e.startBet(r)}else alert("Pelease create wallet first")},children:"Start Bet"})]})},C=function(e){var t=Object(r.useState)(0),n=Object(l.a)(t,2),a=n[0],s=n[1],c=Object(r.useState)(!1),o=Object(l.a)(c,2),i=o[0],u=o[1];Object(r.useEffect)((function(){(new _.a).code2token(Object(S.f)())}),[]),Object(r.useEffect)((function(){w.a.wallet||P.getAccessToken()&&(w.a.setWallet(new _.a),u(!0)),w.a.wallet&&w.a.wallet.getbalance().then((function(e){s(e)}))}),[]);return i?Object(h.jsx)("div",{className:"wallet",children:Object(h.jsx)("div",{className:"walletInfo",children:Object(h.jsx)("div",{className:"balance",children:Object(h.jsxs)("label",{children:["Balance: ",a]})})})}):Object(h.jsx)("div",{className:"wallet",children:Object(h.jsx)("button",{className:"pure-button button-large",onClick:function(e){(new _.a).requestAccount(Object(S.g)())},children:"Login dotwallet"})})};var K=function(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],s=t[1],c=Object(r.useState)(null),o=Object(l.a)(c,2),p=o[0],d=o[1],b=a.a.useReducer((function(e){return!e}))[1],f=function(){var e=Object(u.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("startBet with amount",t),!w.a.wallet){e.next=13;break}return e.next=4,w.a.wallet.getbalance();case 4:if(n=e.sent,!(t>n)){e.next=8;break}return alert("Please fund your wallet address first"),e.abrupt("return");case 8:r=P.getCurrentPlayer(),a={amount:t,tx:{inputs:[],outputs:[]},name:"tic-tac-toe",alicePubKey:"",bobPubKey:"",creator:r,player:"",date:new Date},"alice"===r?Object.assign(a,{alicePubKey:S.c.get("alice")}):Object.assign(a,{bobPubKey:S.c.get("bob")}),P.createGame(a),b();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onDeployed..."),t&&t.alicePubKey&&t.bobPubKey&&m(t.alicePubKey,t.bobPubKey),s(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("onNext",t),b();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function m(e,t){return y.apply(this,arguments)}function y(){return(y=Object(u.a)(i.a.mark((function e(t,n){var r,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==p||!t||!n){e.next=10;break}return e.next=3,w.a.loadContract("/tic-tac-toe/tictactoe_release_desc.json");case 3:return r=e.sent,a=r.contractClass,(s=new a(new x.PubKey(Object(x.toHex)(t)),new x.PubKey(Object(x.toHex)(n)))).setDataPart("00000000000000000000"),d(s),console.log("fetchContract successfully"),e.abrupt("return",s);case 10:return e.abrupt("return",p);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return(j=Object(u.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("joinGame...",t),e.next=3,w.a.wallet.getbalance();case 3:if(!(e.sent<=t.amount)){e.next=7;break}return alert("no available utxos or  balance is not enough, please fund your wallet"),e.abrupt("return");case 7:return e.next=9,w.a.setAllPublicKey(2e4);case 9:return P.getCurrentPlayer(),Object.assign(t,{alicePubKey:S.c.get("alice"),player:"alice"}),Object.assign(t,{bobPubKey:S.c.get("bob"),player:"bob"}),e.next=14,m(t.alicePubKey,t.bobPubKey);case 14:null!=(n=e.sent)&&w.a.deploy(n,t.amount).then((function(e){var n=Object(l.a)(e,2),r=n[0],a=n[1];t.lastUtxo={txHash:a,outputIndex:0,satoshis:r.outputs[0].satoshis,script:r.outputs[0].script},t.tx=r,t.deploy=a,P.saveGame(t,"deployed"),s(!0)})).catch((function(e){"no utxos"===e.message&&alert("no available utxos, please fund your wallet"),console.error("deploy error",e)}));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(r.useEffect)((function(){if(w.a.wallet){var e=P.getGame();e&&e.lastUtxo&&s(!0),e&&e.alicePubKey&&e.bobPubKey&&m(e.alicePubKey,e.bobPubKey),e&&!e.deploy&&function(e){j.apply(this,arguments)}(e)}else setTimeout((function(){alert("Please create your wallet and fund it")}),1e3);return P.addDeployedListener(v),P.addNextListener(g),function(){P.removeDeployedListener(v),P.removeNextListener(g)}}),[p]);var O=P.getGame();return Object(h.jsx)("div",{className:"App",children:Object(h.jsxs)("header",{className:"App-header",children:[Object(h.jsx)("h2",{children:"Play Tic-Tac-Toe on Bitcoin"}),Object(h.jsx)(L,{startBet:f,cancelBet:function(){P.deleteGame(),s(!1),b()},started:n,game:O}),Object(h.jsx)(T,{game:O,contractInstance:p}),Object(h.jsx)(C,{})]})})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,367)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),s(e),c(e)}))};c.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(K,{})}),document.getElementById("root")),E()},6:function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return s})),n.d(t,"h",(function(){return c})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return l}));var r={accountToken:"access_token",refreshToken:"refresh_token",publicKeyBob:"public_key_bob",addressBob:"address_bob",userBob:"user_bob",publicKeyAlice:"public_key_alice",addressAlice:"address_alice",userAlice:"user_alice"},a={dapp_list_unspent:"/v1/grandet_dapp/dapp_list_unspent",dapp_list_unspent_by_address:"/v1/grandet_dapp/dapp_list_unspent_by_address",dapp_sign_raw_transaction:"/v1/grandet_dapp/dapp_sign_raw_transaction",dapp_get_signature:"/v1/grandet_dapp/dapp_get_signature",dapp_get_balance:"/v1/grandet_dapp/dapp_get_balance",dapp_send_raw_transaction:"/v1/grandet_dapp/dapp_send_raw_transaction",dapp_get_raw_change_address:"/v1/grandet_dapp/dapp_get_raw_change_address",dapp_get_public_key:"/v1/grandet_dapp/dapp_get_public_key",get_access_token:"/v1/oauth2/get_access_token"},s=function(){return new URLSearchParams(window.location.search).get("player")||"alice"},c=function(){return new URLSearchParams(window.location.search).get("state")||"alice"},o=function(){return new URLSearchParams(window.location.search).get("code")},i={get:function(){return localStorage.getItem(r.accountToken)},set:function(e){localStorage.setItem(r.accountToken,e)}},u={get:function(e){if(e)return localStorage["public_key_".concat(e)];var t="alice"===s()?r.publicKeyAlice:r.publicKeyBob;return localStorage.getItem(t)},set:function(e,t){if(t)localStorage["public_key_".concat(t)]=e;else{var n="alice"===t?r.publicKeyAlice:r.publicKeyBob;localStorage.setItem(n,e)}}},l={get:function(e){if(e)return localStorage["address_".concat(e)];var t="alice"===s()?r.addressAlice:r.addressBob;return localStorage.getItem(t)},set:function(e,t){if(t)localStorage["address_".concat(t)]=e;else{var n="alice"===t?r.addressAlice:r.addressBob;localStorage.setItem(n,e)}}}},63:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(1),a=n.n(r),s=n(7),c=n(17),o=n(22),i=n(31),u=n(30),l=n(12),p=n(32),d=n.n(p),b=n(6),f=d.a.create({timeout:2e4});f.interceptors.request.use((function(e){var t=b.d.get();return console.log("access_token",t),t&&(e.headers.Authorization="Bearer "+t),e}),(function(e){return Promise.reject(e)}));var h=function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||200!==+t.status){e.next=7;break}if(75e3===+t.data.code&&(localStorage.removeItem(b.d.get()||""),alert("Re-login"),window.location.href=""),0!==+t.data.code){e.next=6;break}return e.abrupt("return",Promise.resolve(t));case 6:return e.abrupt("return",Promise.reject(t));case 7:if(!(t&&t.status>=400)){e.next=9;break}return e.abrupt("return",Promise.reject(t));case 9:return e.abrupt("return",Promise.resolve(t));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();f.interceptors.response.use(h,(function(e){return Promise.reject(e)}));var v=f,g=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.a.Mainnet;Object(c.a)(this,n),(e=t.call(this,r)).API_PREFIX=void 0,e.API_DOTWALLET=void 0,e.CLIENT_ID="c152e571fffb163bc99bb87c51577354",e.loginUrl=void 0,e.sender=void 0,e.code2token=function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r,s,c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,n="".concat(window.location.origin,"/tic-tac-toe"),console.log("redirect_uri",n),e.next=7,d.a.post("https://common.mempool.com/api/dotwallet/get_access_token",{code:t,redirect_uri:n});case 7:r=e.sent,s=r.data,console.log("get_access_token",s),s.data?(c=s.data.access_token)&&(localStorage[b.e.accountToken]=c,o="alice"===Object(b.h)()?"?player=alice":"?player=bob",window.location.href="".concat(window.location.origin).concat(o)):console.error("get_access_token error",s),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("error",e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}(),e.API_PREFIX="https://api.whatsonchain.com/v1/bsv/".concat(r===l.a.Regtest?"test":"main"),e.API_DOTWALLET=r===l.a.Regtest?"http://192.168.1.13:6001":"https://api.ddpurse.com";var o="".concat(e.API_DOTWALLET,"/authorize?client_id=").concat(e.CLIENT_ID,"&redirect_uri=").concat(encodeURIComponent(window.origin),"&response_type=code&scope=").concat(encodeURIComponent("user.info"));return e.loginUrl=o,e.sender=r===l.a.Regtest?{appid:"test_bsv_coin_regular",user_index:0}:{appid:"bsv_coin_regular",user_index:0},e}return Object(o.a)(n,[{key:"requestAccount",value:function(e,t){return window.location.href="".concat(this.loginUrl,"&state=").concat(e),Promise.resolve(!0)}},{key:"getbalance",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_get_balance),{sender:this.sender});case 3:return t=e.sent,n=t.data,e.abrupt("return",n.data.confirm+n.data.unconfirm);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"signRawTransaction",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,r,s){var c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_sign_raw_transaction),{sender:this.sender,input_index:n,sig_type:r,rawtx:t,addr:s},{headers:{}});case 2:return c=e.sent,o=c.data,e.abrupt("return",o.data.signed_rawtx);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getSignature",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,r,s){var c,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_get_signature),{sender:this.sender,input_index:n,sig_type:r,rawtx:t,addr:s},{headers:{player:"alice"}});case 2:return c=e.sent,o=c.data,e.abrupt("return",o.data.hex_signature);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"sendRawTransaction",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_send_raw_transaction),{sender:this.sender,rawTx:t});case 2:return n=e.sent,r=n.data,e.abrupt("return",r.data.txid);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listUnspent",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_list_unspent),{sender:this.sender,min_amount:t},{headers:{player:null===n||void 0===n?void 0:n.purpose}});case 2:return r=e.sent,s=r.data,e.abrupt("return",s.data.utxos.filter((function(e){return e.satoshis>=t})).map((function(e){return{txHash:e.tx_hash,outputIndex:e.output_index,satoshis:e.satoshis,script:e.script,addr:e.addr,pubkey:e.pubkey}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRawChangeAddress",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_get_raw_change_address),{sender:this.sender},{headers:{player:null===t||void 0===t?void 0:t.purpose}});case 2:return n=e.sent,r=n.data,e.abrupt("return",r.data.address);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPublicKey",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.post("".concat(this.API_DOTWALLET).concat(b.a.dapp_get_public_key),{sender:this.sender},{headers:{player:null===t||void 0===t?void 0:t.purpose}});case 2:return n=e.sent,r=n.data,e.abrupt("return",r.data.public_key);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(l.c)}},[[366,1,2]]]);
//# sourceMappingURL=main.8268970c.chunk.js.map